# MountainVista — Delta Report

This compares the recovered **legacy** MountainVista spec from the bundle to the **current** rebuilt MountainVista.project.md in your OS.

Legend: lines starting with `-` are from the recovered legacy spec; `+` are in the current file.

## Quick Stats

- Recovered lines: 12
- Current lines: 101

## Unified Diff (first 600 lines)

--- Recovered(MountainVista_LEGACY)
+++ Current(MountainVista.project.md)
@@ -1,12 +1,101 @@
-# MountainVista (LEGACY)
+# MountainVista.project.md
+Version: UltraPlus OS v7.4R — REAP Pack 2025-09-02
+Timestamp: 2025-09-02 23:06:36Z
 
-> Recovered from bundle — do not overwrite current MountainVista.project.md.
+## 0) Mission
+Deliver a polished MVP web app for Mountain Vista Cleaning Services that:
+- Captures and scores leads (multi-step form, friendly UX)
+- Provides a clean admin portal (view/manage leads/customers)
+- Includes light accounting skeleton + basic budgeting (YNAB-style)
+- Is architected for white-label + future expansion without rework
 
-Title: Mountain Vista AIO MVP
-Version: 7.3.10
-Role: project
-License: Custom-JAWS-EULA-v1
-OwnerTag: Chris
-Namespace: mv:*
+## 1) Stack
+- Next.js 14 (app router), TypeScript
+- Tailwind + shadcn/ui
+- Prisma ORM
+- Neon Postgres (serverless)
+- Vercel (deploy)
+- Sentry (optional) with PII scrubbing
+- Zod (validation)
+- Rate limiting on public endpoints
 
-Note: Not intended to run inside ChatGPT Projects in this deployment.
+## 2) Architecture Decisions (Locked)
+- ✅ RBAC lite (Admin, Staff) with expansion path for Accountant/Client
+- ✅ Soft multi-tenant seam: add tenant_id and branding tokens; single active tenant
+- ✅ Admin polish (compact non-sticky header, logo sizing rules, better tables)
+- ✅ Security hardening (validation, honeypot/rate-limit, secure cookies, CSRF on writes)
+- ✅ Exports: CSV/JSON for Leads/Customers
+- ✅ Short IDs: e.g., MV-{{YYYY}}-#### for customers and LEAD-{{YYYY}}-#### for leads
+- ✅ Accounting light skeleton: chart-of-accounts defaults, manual journal entries, invoice→ledger posting (no tax automation)
+- ✅ Basic budgeting (YNAB-style): category groups + envelopes, manual funding; no forecasting; supports weekly/biweekly/monthly goal cadence
+
+## 3) Data Model (Prisma sketch)
+- Tenant(id, name, slug, brandColor, logoPath)
+- User(id, email, role[ADMIN|STAFF], tenantId, ...)
+- Lead(id short, createdAt, contact info, jobType, jobDetail, urgency, siteAddress, targetStartDate, notes, channel, estimatedBudget, isContractOpportunity, tenantId)
+- Customer(id short, name, phones/emails, addresses, tenantId)
+- Invoice(id, customerId, amount, status, issuedAt, paidAt?, tenantId)
+- LedgerAccount(id, code, name, type[ASSET|LIAB|EQUITY|REV|EXP], tenantId)
+- LedgerEntry(id, accountId, debit, credit, memo, refType, refId, tenantId)
+- BudgetCategory(id, group, name, tenantId)
+- BudgetEnvelope(id, categoryId, month, allocated, available, tenantId)
+- AuditLog(id, actorUserId?, action, entity, entityId, delta, tenantId, createdAt)
+
+## 4) Lead Capture (MVP)
+- Multi-step form:
+  1) Contact: name, phone/email, preferred contact
+  2) Location: service address, city, zip
+  3) Job Type: {"Residential One-time","Residential Recurring","Commercial Janitorial","Commercial One-off","Government/Procurement","Other(+desc)"}
+     - Contract Opportunity? (Yes/No + optional term)
+  4) Timing: targetStartDate (date picker), urgency (ASAP/Within 2 weeks/Within 30 days/Planning)
+  5) Details: brief description, photos(optional), estimatedBudget(optional)
+- Anti-spam: honeypot + rate limit
+- On submit: create LEAD-YYYY-####; send to Admin
+
+## 5) Admin Portal
+- Pages: Dashboard, Leads, Customers, Exports, Settings (branding)
+- Lead detail: show all fields, conversion action → create Customer
+- Customers: list, view, basic edit
+- Exports: CSV/JSON for Leads/Customers
+- Branding (tenant tokens): name, color seed, logo (no sticky header)
+
+## 6) Accounting Light (MVP)
+- Default CoA: basic service business set
+- Manual journal entries
+- Invoice posting → Revenues/AR cash entries (no tax calc; if tax unset, tag “Tax not configured”)
+- CSV export of ledger
+
+## 7) Budgeting Basic (MVP)
+- Category groups and envelopes
+- Funding cadence options: weekly / biweekly / monthly / custom
+- “Goal-by-date” supports early funding buffer (ensure target met before due month)
+- Manual reconciliation; Plaid prep only (no live link in MVP)
+
+## 8) IDs & Generators
+- Short ids via node-side nanoid/sequence hybrid
+- Customer: MV-{{YYYY}}-####; Lead: LEAD-{{YYYY}}-####
+
+## 9) Env & Secrets
+- DATABASE_URL (Neon), NEXTAUTH_SECRET (if used later), SENTRY_DSN(optional)
+- No secrets in repo
+
+## 10) Security
+- Zod schemas on all inputs
+- CSRF on admin mutations
+- Session cookies secure
+- Rate limit public lead POST
+
+## 11) Roadmap (post-MVP)
+- Intake → Scheduling → Work orders → Time tracking
+- Client/Accountant portals
+- Cash-flow-aware budgeting + Plaid
+- Provider adapters (ADP/Paychex/QuickBooks) using Adapter Modules; Live Drivers when paid
+- Multi-tenant enablement + white-label branding
+
+## 12) I do / You do (MVP next session)
+I do:
+- Update schema, migrations, ID helpers, routes, UI polish, exports, budgeting & accounting stubs
+- Add RBAC & tenant seam, seed scripts
+You do:
+- Provide branding assets if changes
+- Add env keys to Vercel as needed (I’ll specify names/values format)